<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROI-360 - Automatize Suas Vendas com I.A.</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">

    <!-- Scripts for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* Custom styles to apply the Inter font */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
            color: #f5f5f5;
        }
        /* Custom gradient for headlines and highlights */
        .gradient-text {
            background: linear-gradient(90deg, #4f46e5, #c026d3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .cta-button {
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
        }
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(192, 38, 211, 0.5);
        }
        .feature-card, .price-card, .contract-card {
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        .feature-card:hover {
            border-color: #4f46e5;
            transform: translateY(-5px);
        }

        /* Contract & Checkout Styles */
        .tab-button.active {
            border-color: #4f46e5; /* Indigo */
            color: #818cf8; /* Light Indigo */
            background-color: rgba(79, 70, 229, 0.1);
        }
        .signature-canvas {
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: #f8fafc;
            cursor: crosshair;
            touch-action: none;
        }
        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .input-group input {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.375rem;
            font-size: 1rem;
            color: #f5f5f5;
            background-color: #1f2937; /* Gray 800 */
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        #notification-toast {
            position: fixed; bottom: 20px; left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px; border-radius: 8px;
            color: white; font-weight: 500;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            opacity: 0; visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
            z-index: 1000;
        }
        #notification-toast.show {
            opacity: 1; visibility: visible;
            transform: translate(-50%, -10px);
        }
        .spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="antialiased overflow-x-hidden">
    <div id="notification-toast"></div>

    <!-- Header -->
    <header class="py-4 px-6 md:px-10 flex justify-between items-center sticky top-0 z-50 bg-black/50 backdrop-blur-lg border-b border-gray-800">
        <h1 class="text-2xl font-bold text-white">ROI-<span class="gradient-text">360</span></h1>
        <a href="#pricing" class="cta-button bg-gradient-to-r from-indigo-600 to-purple-700 text-white font-semibold py-2 px-6 rounded-lg shadow-lg">
            Ver Planos
        </a>
    </header>

    <!-- Main Content -->
    <main id="main-content">
        <!-- Hero Section -->
        <section class="text-center py-20 md:py-32 px-4">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-4xl md:text-6xl font-black tracking-tight leading-tight mb-6">
                    Vendas Diárias, Sem Anúncios. <span class="gradient-text">O Poder da Automação com I.A.</span>
                </h2>
                <p class="text-lg md:text-xl text-gray-400 max-w-2xl mx-auto mb-10">
                    Nossos Agentes de Inteligência Artificial trabalham 24/7 para encontrar, qualificar e engajar seus clientes ideais, transformando suas vendas em uma máquina de receita previsível.
                </p>
                <a href="#pricing" class="cta-button inline-block bg-gradient-to-r from-indigo-600 to-purple-700 text-white font-bold text-xl py-4 px-10 rounded-lg shadow-xl">
                    Quero Automatizar Minhas Vendas
                </a>
            </div>
        </section>

        <!-- Problem Section -->
        <section id="problem" class="py-20 px-4 bg-black">
            <div class="max-w-5xl mx-auto">
                <div class="text-center mb-12">
                    <h3 class="text-3xl md:text-4xl font-bold mb-4">A insegurança do tráfego pago está custando caro.</h3>
                    <p class="text-gray-400 max-w-3xl mx-auto">Sua empresa vive em uma montanha-russa de resultados, totalmente dependente de algoritmos que mudam sem aviso prévio.</p>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <!-- Pain Point 1 -->
                    <div class="feature-card p-6 rounded-xl">
                        <div class="text-indigo-400 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                        </div>
                        <h4 class="font-bold text-lg mb-2">Custos Crescentes</h4>
                        <p class="text-gray-400 text-sm">Orçamentos de anúncios que só aumentam e devoram sua margem de lucro.</p>
                    </div>
                    <!-- Pain Point 2 -->
                    <div class="feature-card p-6 rounded-xl">
                        <div class="text-indigo-400 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
                        </div>
                        <h4 class="font-bold text-lg mb-2">Resultados Imprevisíveis</h4>
                        <p class="text-gray-400 text-sm">Um dia você tem leads, no outro, o algoritmo muda e tudo para.</p>
                    </div>
                    <!-- Pain Point 3 -->
                    <div class="feature-card p-6 rounded-xl">
                        <div class="text-indigo-400 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"></path></svg>
                        </div>
                        <h4 class="font-bold text-lg mb-2">Dependência Total</h4>
                        <p class="text-gray-400 text-sm">Seu faturamento depende 100% de plataformas como Google e Meta.</p>
                    </div>
                    <!-- Pain Point 4 -->
                    <div class="feature-card p-6 rounded-xl">
                        <div class="text-indigo-400 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20v-6M6 20v-4M18 20v-8"></path></svg>
                        </div>
                        <h4 class="font-bold text-lg mb-2">Complexidade e Tempo</h4>
                        <p class="text-gray-400 text-sm">Gerenciar campanhas, criativos e métricas exige tempo e expertise.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Solution Section -->
        <section id="solution" class="py-20 px-4">
            <div class="max-w-5xl mx-auto">
                <div class="text-center mb-16">
                    <h3 class="text-3xl md:text-4xl font-bold mb-4">A Solução: <span class="gradient-text">Agentes de I.A. ROI-360</span></h3>
                    <p class="text-gray-400 max-w-3xl mx-auto">Uma força de vendas digital, personalizada e incansável que prospecta clientes organicamente, 24 horas por dia, 7 dias por semana.</p>
                </div>
                <div class="relative">
                    <div class="hidden md:block absolute top-6 bottom-6 left-1/2 w-0.5 -translate-x-1/2 bg-gray-700 border border-dashed border-gray-600"></div>
                    <div class="relative md:flex w-full mb-16">
                        <div class="md:w-1/2 flex justify-end md:pr-16"><div class="p-6 bg-gray-900 border border-gray-800 rounded-xl max-w-sm text-right"><h4 class="text-xl font-bold mb-2 text-indigo-400">1. Mapeamento Estratégico</h4><p class="text-gray-300">Entendemos a fundo seu negócio para construir a estratégia de prospecção perfeita.</p></div></div><div class="md:w-1/2"></div><div class="hidden md:flex absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-indigo-600 border-4 border-gray-800 items-center justify-center text-white font-bold text-xl z-10">1</div>
                    </div>
                    <div class="relative md:flex w-full mb-16">
                        <div class="md:w-1/2"></div><div class="md:w-1/2 flex justify-start md:pl-16"><div class="p-6 bg-gray-900 border border-gray-800 rounded-xl max-w-sm"><h4 class="text-xl font-bold mb-2 text-indigo-400">2. Implementação do Agente I.A.</h4><p class="text-gray-300">Configuramos e treinamos seu agente para buscar e iniciar conversas com potenciais clientes.</p></div></div><div class="hidden md:flex absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-indigo-600 border-4 border-gray-800 items-center justify-center text-white font-bold text-xl z-10">2</div>
                    </div>
                    <div class="relative md:flex w-full mb-16">
                        <div class="md:w-1/2 flex justify-end md:pr-16"><div class="p-6 bg-gray-900 border border-gray-800 rounded-xl max-w-sm text-right"><h4 class="text-xl font-bold mb-2 text-indigo-400">3. Engajamento e Qualificação</h4><p class="text-gray-300">O agente nutre o relacionamento e entrega apenas leads quentes e qualificados.</p></div></div><div class="md:w-1/2"></div><div class="hidden md:flex absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-indigo-600 border-4 border-gray-800 items-center justify-center text-white font-bold text-xl z-10">3</div>
                    </div>
                    <div class="relative md:flex w-full">
                        <div class="md:w-1/2"></div><div class="md:w-1/2 flex justify-start md:pl-16"><div class="p-6 bg-gray-900 border border-gray-800 rounded-xl max-w-sm"><h4 class="text-xl font-bold mb-2 text-indigo-400">4. Vendas Humanizadas</h4><p class="text-gray-300">Sua equipe foca 100% em fechar negócios com leads que já demonstraram interesse.</p></div></div><div class="hidden md:flex absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-indigo-600 border-4 border-gray-800 items-center justify-center text-white font-bold text-xl z-10">4</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Pricing Section -->
        <section id="pricing" class="py-20 px-4 bg-black">
            <div class="max-w-5xl mx-auto">
                <div class="text-center mb-12">
                    <h3 class="text-3xl md:text-4xl font-bold mb-4">Comece Sua Jornada de Automação</h3>
                    <p class="text-gray-400 max-w-3xl mx-auto">Construa a base do seu crescimento com um motor de vendas que nunca para.</p>
                </div>
                <div class="flex justify-center">
                    <div class="price-card p-8 rounded-2xl flex flex-col max-w-md">
                        <h4 class="text-2xl font-bold text-indigo-400 mb-2">Plano Orgânico I.A.</h4>
                        <p class="text-gray-300 mb-6">A base para sua máquina de vendas.</p>
                        <div class="mb-6"><p class="text-gray-400 text-sm">Taxa única de implementação</p><p class="text-4xl font-black text-white">$1,350</p></div>
                        <div class="mb-6"><p class="text-gray-400 text-sm">Custo operacional mensal</p><p class="text-4xl font-black text-white">$450<span class="text-xl font-medium text-gray-400">/mês</span></p></div>
                        <ul class="space-y-4 text-gray-300 flex-grow mb-8">
                            <li class="flex items-start"><span class="text-indigo-500 mr-3 mt-1">✓</span> Mapeamento estratégico e setup</li>
                            <li class="flex items-start"><span class="text-indigo-500 mr-3 mt-1">✓</span> Prospecção e qualificação 24/7</li>
                            <li class="flex items-start"><span class="text-indigo-500 mr-3 mt-1">✓</span> Otimização constante das campanhas</li>
                            <li class="flex items-start"><span class="text-indigo-500 mr-3 mt-1">✓</span> Relatórios de performance e insights</li>
                            <li class="flex items-start"><span class="text-indigo-500 mr-3 mt-1">✓</span> Suporte técnico contínuo</li>
                        </ul>
                        <button data-plan="organico_ia" class="cta-button w-full text-center bg-gradient-to-r from-indigo-800 to-purple-900 hover:from-indigo-600 hover:to-purple-700 text-white font-bold py-3 px-8 rounded-lg mt-auto">
                            Construir Minha Base
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Controversial Truth Section -->
        <section id="controversy" class="py-20 px-4 bg-gray-900/50">
            <div class="max-w-3xl mx-auto text-center">
                <h3 class="text-3xl md:text-4xl font-bold mb-6">Uma Verdade <span class="gradient-text">Controversa</span> Sobre Anúncios</h3>
                <p class="text-lg text-gray-400 mb-4">A base do seu crescimento deve ser orgânica, sólida e previsível.</p>
                <p class="text-lg text-gray-300 font-semibold mb-8">Mas e se, no futuro, você pudesse usar a mesma inteligência para criar campanhas pagas cirurgicamente precisas?</p>
                <div class="p-6 border border-indigo-500/30 rounded-xl bg-black">
                    <p class="text-gray-400">Uma vez que seu motor orgânico esteja funcionando, nossos Agentes de I.A. podem analisar os dados dos seus melhores clientes para otimizar campanhas de tráfego pago, transformando-as de uma aposta cara em um investimento com ROI garantido. Primeiro a liberdade, depois o domínio total.</p>
                </div>
            </div>
        </section>

        <!-- Upgrade Pricing Section -->
        <section id="upgrade-pricing" class="py-20 px-4 bg-black">
            <div class="max-w-5xl mx-auto">
                <div class="text-center mb-12">
                    <h3 class="text-3xl md:text-4xl font-bold mb-4">Pronto para o Próximo Nível?</h3>
                    <p class="text-gray-400 max-w-3xl mx-auto">Para empresas que não querem apenas competir, mas dominar o mercado, apresentamos a solução definitiva.</p>
                </div>
                <div class="flex justify-center">
                    <div class="price-card p-8 rounded-2xl flex flex-col max-w-md border-2 border-indigo-600 relative">
                        <div class="absolute top-0 -translate-y-1/2 left-1/2 -translate-x-1/2 bg-indigo-600 text-white text-xs font-bold px-3 py-1 rounded-full">UPGRADE PREMIUM</div>
                        <h4 class="text-2xl font-bold text-indigo-400 mb-2">Plano Domínio 360</h4>
                        <p class="text-gray-300 mb-6">Prospecção I.A. + Tráfego de Performance</p>
                        <div class="mb-6"><p class="text-gray-400 text-sm">Mensalidade All-in-One</p><div class="text-5xl font-black mb-1">$2,250 <span class="text-2xl font-medium text-gray-400">/mês</span></div></div>
                        <ul class="space-y-4 text-gray-300 flex-grow mb-8">
                            <li class="flex items-start"><span class="font-bold text-indigo-400 mr-3 mt-1">✓</span> <span class="font-bold">Tudo do Plano Orgânico I.A., e mais:</span></li>
                            <li class="flex items-start"><span class="text-indigo-500 mr-3 mt-1">✓</span> Gestão de Tráfego de Performance</li>
                            <li class="flex items-start"><span class="text-indigo-500 mr-3 mt-1">✓</span> Otimização de Anúncios com I.A.</li>
                            <li class="flex items-start"><span class="text-indigo-500 mr-3 mt-1">✓</span> Criação de Públicos de Alta Conversão</li>
                            <li class="flex items-start"><span class="text-indigo-500 mr-3 mt-1">✓</span> Análise Preditiva de ROI em anúncios</li>
                            <li class="flex items-start"><span class="text-indigo-500 mr-3 mt-1">✓</span> Relatórios de performance unificados</li>
                        </ul>
                        <button data-plan="dominio_360" class="cta-button w-full text-center bg-gradient-to-r from-indigo-600 to-purple-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg mt-auto">
                            Dominar o Mercado
                        </button>
                    </div>
                </div>
                <p class="text-center text-gray-500 mt-8 text-sm">* O valor do investimento em anúncios (orçamento de tráfego) não está incluso na mensalidade do Plano Domínio 360.</p>
            </div>
        </section>
    </main>

    <!-- CONTRACT & CHECKOUT SECTIONS (Initially Hidden) -->
    <section id="contract-section" class="hidden container mx-auto p-4 md:p-8">
        <div class="contract-card p-4 sm:p-8">
            <header class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold gradient-text">Contrato de Prestação de Serviços</h1>
                <p id="contract-header-subtitle" class="text-gray-400 mt-2">Sua Empresa & ROI-360</p>
            </header>
            <nav id="contract-tabs" class="flex flex-wrap border-b border-gray-700 mb-6">
                <button data-tab="overview" class="tab-button active text-sm sm:text-base font-medium py-3 px-3 sm:px-5 border-b-2 border-transparent">Visão Geral</button>
                <button data-tab="parties" class="tab-button text-sm sm:text-base font-medium py-3 px-3 sm:px-5 border-b-2 border-transparent">Partes</button>
                <button data-tab="services" class="tab-button text-sm sm:text-base font-medium py-3 px-3 sm:px-5 border-b-2 border-transparent">Serviços</button>
                <button data-tab="financial" class="tab-button text-sm sm:text-base font-medium py-3 px-3 sm:px-5 border-b-2 border-transparent">Financeiro</button>
                <button data-tab="term" class="tab-button text-sm sm:text-base font-medium py-3 px-3 sm:px-5 border-b-2 border-transparent">Prazo</button>
                <button data-tab="signatures" class="tab-button text-sm sm:text-base font-medium py-3 px-3 sm:px-5 border-b-2 border-transparent">Assinaturas</button>
            </nav>
            <main id="contract-content"><!-- Contract content will be populated by JS --></main>
        </div>
    </section>

    <section id="checkout-section" class="hidden container mx-auto p-4 md:p-8">
         <div class="contract-card p-4 sm:p-8 max-w-2xl mx-auto">
             <header class="text-center mb-8">
                 <h1 class="text-3xl md:text-4xl font-bold gradient-text">Finalizar Pagamento</h1>
                 <p id="checkout-summary" class="text-gray-400 mt-2">Plano selecionado: <span class="font-bold text-indigo-400"></span></p>
             </header>
             <div class="flex justify-center">
                 <div id="pix-container" class="p-6 rounded-lg bg-black text-center w-full md:w-2/3">
                     <!-- PIX content will be populated by JS -->
                 </div>
             </div>
             <div class="text-center mt-8">
                 <button id="back-to-proposal-btn" class="text-indigo-400 hover:text-indigo-300">&larr; Voltar para os Planos</button>
             </div>
         </div>
    </section>

    <!-- Footer -->
    <footer class="bg-black py-8 px-4 border-t border-gray-800">
        <div class="max-w-5xl mx-auto text-center text-gray-500">
            <p class="font-bold text-lg mb-2">ROI-360</p>
            <p>&copy; 2024 ROI-360. Todos os direitos reservados.</p>
            <p>Transformando vendas com Inteligência Artificial.</p>
        </div>
    </footer>

    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        let db, auth, userId;
        let selectedPlan = {};
        let currentClientData = null;
        let isAuthReady = false; // State to track Firebase auth readiness

        const planDetails = {
            organico_ia: { 
                name: "Plano Orgânico I.A.", 
                priceText: "$1,350 (Implementação) + $450/mês",
                checkoutPrice: 1350.00,
                financialClause: "O CONTRATANTE pagará ao CONTRATADO o valor único de <strong>$1,350 (mil trezentos e cinquenta dólares)</strong> referente à implementação e, a partir do segundo mês, o valor mensal de <strong>$450 (quatrocentos e cinquenta dólares)</strong> pela operação contínua.",
                services: [
                    "Mapeamento estratégico e setup do Agente de I.A.",
                    "Prospecção e qualificação de leads 24/7.",
                    "Otimização constante das campanhas de prospecção.",
                    "Relatórios de performance e insights.",
                    "Suporte técnico contínuo."
                ] 
            },
            dominio_360: { 
                name: "Plano Domínio 360", 
                priceText: "$2,250/mês",
                checkoutPrice: 2250.00,
                financialClause: "O CONTRATANTE pagará ao CONTRATADO o valor mensal de <strong>$2,250 (dois mil duzentos e cinquenta dólares)</strong>. O investimento em anúncios é de responsabilidade do CONTRATANTE.",
                services: [
                    "Todos os itens do Plano Orgânico I.A.",
                    "Gestão de Tráfego de Performance (Google/Meta Ads).",
                    "Otimização de Anúncios com I.A.",
                    "Criação de Públicos de Alta Conversão.",
                    "Análise Preditiva de ROI em anúncios.",
                    "Relatórios de performance unificados (Orgânico + Pago)."
                ] 
            }
        };

        const mainContent = document.getElementById('main-content');
        const contractSection = document.getElementById('contract-section');
        const checkoutSection = document.getElementById('checkout-section');
        const notificationToast = document.getElementById('notification-toast');

        function showNotification(message, type = 'info', duration = 4000) {
            notificationToast.textContent = message;
            notificationToast.className = `fixed bottom-5 left-1/2 -translate-x-1/2 px-6 py-3 rounded-lg text-white font-semibold shadow-lg transition-all duration-300 show`;
            notificationToast.classList.add(type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-indigo-500');
            setTimeout(() => { notificationToast.className = notificationToast.className.replace('show', ''); }, duration);
        }

        async function initializeFirebase() {
            try {
                // Use environment-provided config, with a fallback for local testing
                const firebaseConfig = typeof __firebase_config !== 'undefined'
                    ? JSON.parse(__firebase_config)
                    : {
                        apiKey: "YOUR_API_KEY", // IMPORTANT: Replace with your actual config for GitHub Pages
                        authDomain: "contrato-839eb.firebaseapp.com",
                        projectId: "contrato-839eb",
                        storageBucket: "contrato-839eb.appspot.com",
                        messagingSenderId: "257509711471",
                        appId: "1:257509711471:web:bcd069639d845fd88db79a"
                    };

                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Listen for auth state changes to get the user ID
                onAuthStateChanged(auth, user => {
                    if (user) {
                        userId = user.uid;
                        console.log("Authenticated with UID:", userId);
                        if (!isAuthReady) {
                            isAuthReady = true;
                            // Enable the plan buttons now that auth is ready
                            document.querySelectorAll('button[data-plan]').forEach(button => {
                                button.disabled = false;
                                button.innerHTML = button.dataset.originalText;
                            });
                        }
                    } else {
                        userId = null;
                        isAuthReady = false;
                        console.log("User is signed out.");
                        showNotification("Falha na autenticação. A página será recarregada.", "error", 5000);
                        document.querySelectorAll('button[data-plan]').forEach(button => {
                            button.disabled = true;
                            button.innerHTML = `<span>Falha na Conexão</span>`;
                        });
                        setTimeout(() => window.location.reload(), 5000);
                    }
                });

                // Sign in using the provided token or fall back to anonymous
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Firebase initialization failed:", error);
                if (error.code === 'auth/operation-not-allowed') {
                    showNotification("Erro de Configuração: Login anônimo não está habilitado no seu painel do Firebase. Vá para Authentication > Sign-in method e ative 'Anônimo'.", "error", 10000);
                } else {
                    showNotification("Erro ao conectar com o sistema de contratos.", "error");
                }
            }
        }

        function setupContract(planKey) {
            selectedPlan = planDetails[planKey];
            mainContent.classList.add('hidden');
            contractSection.classList.remove('hidden');
            checkoutSection.classList.add('hidden');

            const contractContent = document.getElementById('contract-content');
            contractContent.innerHTML = `
                <!-- Overview -->
                <section id="overview" class="tab-content prose max-w-none text-gray-300">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-black p-6 rounded-lg"><h3 class="font-bold text-lg mb-2 text-indigo-400">Objeto Principal</h3><p>Automação de Vendas e Prospecção com I.A.</p></div>
                        <div class="bg-black p-6 rounded-lg"><h3 class="font-bold text-lg mb-2 text-indigo-400">Valor</h3><p class="text-xl font-bold">${selectedPlan.priceText}</p></div>
                        <div class="bg-black p-6 rounded-lg"><h3 class="font-bold text-lg mb-2 text-indigo-400">Prazo do Contrato</h3><p class="text-xl font-bold">6 meses</p></div>
                    </div>
                </section>
                <!-- Parties -->
                <section id="parties" class="tab-content hidden"><div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="border border-gray-700 rounded-lg p-6">
                        <h3 class="font-bold text-xl mb-4 text-indigo-400">CONTRATANTE</h3>
                        <div id="contratante-form" class="form-section space-y-4">
                            <div class="input-group"><label for="input-nome-completo">Nome da Empresa/Razão Social:</label><input type="text" id="input-nome-completo" required></div>
                            <div class="input-group"><label for="input-cnpj">CPF/CNPJ:</label><input type="text" id="input-cnpj" required></div>
                            <div class="input-group"><label for="input-endereco">Endereço Completo:</label><input type="text" id="input-endereco"></div>
                            <div class="input-group"><label for="input-email">E-mail de Contato:</label><input type="email" id="input-email" required></div>
                            <button id="save-data-btn" class="mt-4 cta-button w-full text-center bg-gradient-to-r from-indigo-600 to-purple-700 text-white font-bold py-2 px-6 rounded-lg">Salvar Dados do Contratante</button>
                        </div>
                    </div>
                    <div class="border border-gray-700 rounded-lg p-6 text-gray-300"><h3 class="font-bold text-xl mb-4 text-indigo-400">CONTRATADO</h3><p><strong>Nome:</strong> ROI-360 (Matheus Henrique Laurindo)</p><p><strong>CNPJ/CPF:</strong> 100.936.909-16</p><p><strong>Endereço:</strong> Rua Aquidabã, 199, Escola Agrícola, Blumenau, SC, 89037-740</p><p><strong>E-mail:</strong> laurindomatheus40@gmail.com</p></div>
                </div></section>
                <!-- Services -->
                <section id="services" class="tab-content hidden prose max-w-none text-gray-300"><h2 class="text-indigo-400">CLÁUSULA 1 – OBJETO</h2><p>O objeto é a prestação de serviços de Automação de Vendas e Prospecção com I.A., conforme o <strong>${selectedPlan.name}</strong>, que inclui:</p><ul id="service-list" class="list-disc list-inside space-y-2">${selectedPlan.services.map(s => `<li>${s}</li>`).join('')}</ul></section>
                <!-- Financial -->
                <section id="financial" class="tab-content hidden prose max-w-none text-gray-300"><h2 class="text-indigo-400">CLÁUSULA 2 – VALOR E PAGAMENTO</h2><p>${selectedPlan.financialClause}</p></section>
                <!-- Term & Termination -->
                <section id="term" class="tab-content hidden prose max-w-none text-gray-300"><h2 class="text-indigo-400">CLÁUSULA 3 – PRAZO E RESCISÃO</h2><p>Este contrato tem vigência de 6 meses, renovado automaticamente por iguais períodos. A rescisão por qualquer uma das partes exige aviso prévio de 30 dias. Em caso de rescisão imotivada pelo CONTRATANTE durante o prazo inicial, incidirá multa de 20% sobre o valor restante do contrato.</p></section>
                <!-- Signatures -->
                <section id="signatures" class="tab-content hidden prose max-w-none text-gray-300"><p>As partes, de pleno acordo, assinam o presente Contrato.</p><p id="signature-date-location" class="font-semibold">Blumenau/SC, ${new Date().toLocaleDateString('pt-BR')}</p><div class="mt-12 grid grid-cols-1 md:grid-cols-2 gap-12 text-center"><div><p class="text-lg">Assinatura do Contratante:</p><div class="mt-4 flex flex-col items-center"><canvas id="signature-canvas" class="signature-canvas w-full max-w-sm h-32 rounded-md"></canvas><button id="clear-signature-btn" class="mt-2 text-sm text-gray-400 hover:text-white">Limpar</button></div></div><div><p class="text-lg">Assinatura do Contratado:</p><div class="mt-4 text-2xl font-serif italic text-indigo-300">ROI-360</div></div></div><div class="text-center mt-12"><button id="proceed-to-checkout-btn" class="cta-button inline-flex items-center bg-gradient-to-r from-indigo-600 to-purple-700 text-white font-bold text-lg px-10 py-4 rounded-lg"><span id="btn-text">Assinar, Gerar PDF e Pagar</span><div id="btn-spinner" class="hidden spinner w-5 h-5 border-2 border-white border-t-transparent rounded-full ml-3"></div></button></div></section>
            `;

            document.querySelectorAll('#contract-tabs .tab-button').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const targetId = e.currentTarget.getAttribute('data-tab');
                    document.querySelectorAll('#contract-tabs .tab-button').forEach(t => t.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    document.querySelectorAll('#contract-content .tab-content').forEach(content => {
                        content.classList.toggle('hidden', content.id !== targetId);
                    });
                });
            });
            
            document.getElementById('save-data-btn').addEventListener('click', saveContractorData);

            const signatureCanvas = document.getElementById('signature-canvas');
            const signatureCtx = signatureCanvas.getContext('2d');
            let drawing = false;
            const getCoords = (e) => {
                const rect = signatureCanvas.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                return { x: clientX - rect.left, y: clientY - rect.top };
            }
            const startDrawing = (e) => { e.preventDefault(); drawing = true; const { x, y } = getCoords(e); signatureCtx.moveTo(x, y); };
            const endDrawing = () => { drawing = false; signatureCtx.beginPath(); };
            const draw = (e) => {
                if (!drawing) return;
                e.preventDefault();
                const { x, y } = getCoords(e);
                signatureCtx.lineWidth = 2; signatureCtx.lineCap = 'round'; signatureCtx.strokeStyle = '#000000';
                signatureCtx.lineTo(x, y); signatureCtx.stroke(); signatureCtx.beginPath(); signatureCtx.moveTo(x, y);
            };
            signatureCanvas.addEventListener('mousedown', startDrawing);
            signatureCanvas.addEventListener('mouseup', endDrawing);
            signatureCanvas.addEventListener('mousemove', draw);
            signatureCanvas.addEventListener('mouseout', endDrawing);
            signatureCanvas.addEventListener('touchstart', startDrawing);
            signatureCanvas.addEventListener('touchend', endDrawing);
            signatureCanvas.addEventListener('touchmove', draw);
            document.getElementById('clear-signature-btn').addEventListener('click', () => {
                signatureCtx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
            });

            document.getElementById('proceed-to-checkout-btn').addEventListener('click', finalizeContract);
            document.querySelector('#contract-tabs .tab-button[data-tab="overview"]').click();
            window.scrollTo(0, 0);
        }

        function saveContractorData() {
            const data = {
                nomeCompleto: document.getElementById('input-nome-completo').value,
                cnpj: document.getElementById('input-cnpj').value,
                endereco: document.getElementById('input-endereco').value,
                email: document.getElementById('input-email').value,
            };

            if (!data.nomeCompleto || !data.cnpj || !data.email) {
                showNotification("Preencha Nome, CNPJ/CPF e E-mail.", "error");
                return;
            }

            currentClientData = data;
            
            // Bloquear todos os campos
            document.getElementById('input-nome-completo').readOnly = true;
            document.getElementById('input-cnpj').readOnly = true;
            document.getElementById('input-endereco').readOnly = true;
            document.getElementById('input-email').readOnly = true;
            
            // Adicionar classe visual para campos bloqueados
            const inputs = ['input-nome-completo', 'input-cnpj', 'input-endereco', 'input-email'];
            inputs.forEach(id => {
                const input = document.getElementById(id);
                input.classList.add('bg-gray-600', 'text-gray-300', 'cursor-not-allowed');
            });
            
            // Substituir botão de salvar por botão de editar
            const saveBtn = document.getElementById('save-data-btn');
            saveBtn.innerHTML = 'Dados Salvos ✓';
            saveBtn.disabled = true;
            saveBtn.classList.remove('bg-gradient-to-r', 'from-indigo-600', 'to-purple-700');
            saveBtn.classList.add('bg-green-600', 'cursor-not-allowed');
            
            // Adicionar botão de editar
            const editBtn = document.createElement('button');
            editBtn.id = 'edit-data-btn';
            editBtn.innerHTML = 'Editar Dados';
            editBtn.className = 'mt-2 w-full text-center bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-lg';
            editBtn.addEventListener('click', unlockContractorData);
            saveBtn.parentNode.insertBefore(editBtn, saveBtn.nextSibling);

            showNotification("Dados do contratante salvos com sucesso!", "success");
            document.querySelector('[data-tab="services"]').click(); // Mover para a próxima aba
        }

        function unlockContractorData() {
            // Desbloquear campos
            const inputs = ['input-nome-completo', 'input-cnpj', 'input-endereco', 'input-email'];
            inputs.forEach(id => {
                const input = document.getElementById(id);
                input.readOnly = false;
                input.classList.remove('bg-gray-600', 'text-gray-300', 'cursor-not-allowed');
            });
            
            // Restaurar botão de salvar
            const saveBtn = document.getElementById('save-data-btn');
            saveBtn.innerHTML = 'Salvar Dados do Contratante';
            saveBtn.disabled = false;
            saveBtn.classList.add('bg-gradient-to-r', 'from-indigo-600', 'to-purple-700');
            saveBtn.classList.remove('bg-green-600', 'cursor-not-allowed');
            
            // Remover botão de editar
            const editBtn = document.getElementById('edit-data-btn');
            if (editBtn) editBtn.remove();
            
            showNotification("Campos liberados para edição", "info");
        }

        async function generateContractPDF(clientData, signatureDataURL) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'p',
                unit: 'mm',
                format: 'a4'
            });

            // Margens conforme ABNT NBR 14724
            const margins = {
                top: 30,
                bottom: 20,
                left: 30,
                right: 20
            };
            
            const usableWidth = doc.internal.pageSize.width - margins.left - margins.right;
            let y = margins.top;
            const lineSpacing = 6; // Espaçamento 1,5 conforme ABNT

            const checkPageBreak = (neededHeight = 25) => {
                if (y + neededHeight > doc.internal.pageSize.height - margins.bottom) {
                    doc.addPage();
                    y = margins.top;
                }
            };

            // Função para adicionar texto justificado
            const addJustifiedText = (text, fontSize = 12, isBold = false) => {
                doc.setFontSize(fontSize);
                doc.setFont('times', isBold ? 'bold' : 'normal');
                const splitText = doc.splitTextToSize(text, usableWidth);
                doc.text(splitText, margins.left, y);
                y += (splitText.length * lineSpacing);
            };

            // Função para adicionar título centralizado
            const addCenteredTitle = (text, fontSize = 14, isBold = true) => {
                doc.setFontSize(fontSize);
                doc.setFont('times', isBold ? 'bold' : 'normal');
                doc.text(text, doc.internal.pageSize.width / 2, y, { align: 'center' });
                y += lineSpacing * 1.5;
            };

            // CABEÇALHO
            addCenteredTitle("CONTRATO DE PRESTAÇÃO DE SERVIÇOS", 16, true);
            y += lineSpacing;

            // QUALIFICAÇÃO DAS PARTES
            addJustifiedText("Pelo presente instrumento particular, as partes abaixo qualificadas:", 12, false);
            y += lineSpacing;

            addJustifiedText(`CONTRATANTE: ${clientData.nomeCompleto}, pessoa jurídica de direito privado, inscrita no CNPJ/CPF sob o nº ${clientData.cnpj}, com sede em ${clientData.endereco}, neste ato representada na forma de seu contrato social, doravante denominada simplesmente CONTRATANTE.`, 12, false);
            y += lineSpacing;

            addJustifiedText("CONTRATADO: ROI-360, representado por Matheus Henrique Laurindo, inscrito no CPF sob o nº 100.936.909-16, com sede na Rua Aquidabã, 199, Escola Agrícola, Blumenau, SC, CEP 89037-740, doravante denominado simplesmente CONTRATADO.", 12, false);
            y += lineSpacing * 2;

            addJustifiedText("Têm entre si justo e acordado o presente CONTRATO DE PRESTAÇÃO DE SERVIÇOS, mediante as cláusulas e condições a seguir estabelecidas:", 12, false);
            y += lineSpacing * 2;

            // CLÁUSULAS
            const addClause = (numero, titulo, texto) => {
                checkPageBreak(40);
                
                // Título da cláusula em maiúsculo e negrito
                addJustifiedText(`CLÁUSULA ${numero}ª – ${titulo.toUpperCase()}`, 12, true);
                y += lineSpacing / 2;
                
                // Texto da cláusula
                addJustifiedText(texto, 12, false);
                y += lineSpacing * 1.5;
            };

            // Remover tags HTML do texto financeiro
            const financialClauseText = selectedPlan.financialClause
                .replace(/<strong>/g, '')
                .replace(/<\/strong>/g, '');

            addClause("PRIMEIRA", "DO OBJETO", 
                `O presente contrato tem como objeto a prestação de serviços de Automação de Vendas e Prospecção com Inteligência Artificial, conforme detalhado no ${selectedPlan.name}. Os serviços compreendem: ${selectedPlan.services.join('; ')}.`);

            addClause("SEGUNDA", "DO VALOR E FORMA DE PAGAMENTO", financialClauseText);

            addClause("TERCEIRA", "DO PRAZO E RESCISÃO",
                "O presente contrato terá vigência de 6 (seis) meses, contados a partir da data de sua assinatura, renovando-se automaticamente por iguais períodos successivos, salvo manifestação expressa em contrário de qualquer das partes, mediante aviso prévio de 30 (trinta) dias. Em caso de rescisão imotivada pelo CONTRATANTE durante o prazo inicial, será devida multa compensatória equivalente a 20% (vinte por cento) do valor remanescente do contrato.");

            addClause("QUARTA", "DAS OBRIGAÇÕES",
                "Constitui obrigação do CONTRATADO prestar os serviços objeto deste contrato com zelo, diligência e de acordo com as melhores práticas de mercado. O CONTRATANTE obriga-se a fornecer todas as informações, acessos e dados necessários à execução dos serviços, bem como efetuar os pagamentos nos prazos estabelecidos.");

            addClause("QUINTA", "DA CONFIDENCIALIDADE",
                "As partes comprometem-se a manter sigilo absoluto sobre todas as informações confidenciais a que tiverem acesso em razão deste contrato, obrigando-se a não divulgá-las a terceiros sem prévia autorização por escrito da parte detentora da informação.");

            addClause("SEXTA", "DO FORO",
                "Fica eleito o foro da comarca de Blumenau, Estado de Santa Catarina, para dirimir quaisquer controvérsias oriundas do presente contrato, renunciando as partes a qualquer outro, por mais privilegiado que seja.");

            // ENCERRAMENTO
            y += lineSpacing * 2;
            checkPageBreak(80);
            
            addJustifiedText("E, por estarem assim justas e contratadas, firmam o presente contrato em duas vias de igual teor e forma, para que produza seus efeitos legais.", 12, false);
            y += lineSpacing * 2;

            // Data e local
            const currentDate = new Date().toLocaleDateString('pt-BR', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });
            
            doc.text(`Blumenau/SC, ${currentDate}.`, doc.internal.pageSize.width / 2, y, { align: 'center' });
            y += lineSpacing * 4;

            // ASSINATURAS
            const signatureY = y;
            const signatureWidth = 70;
            const contractorX = margins.left + (usableWidth / 4) - (signatureWidth / 2);
            const contractedX = margins.left + (usableWidth * 3 / 4) - (signatureWidth / 2);

            // Assinatura do contratante
            if (signatureDataURL) {
                doc.addImage(signatureDataURL, 'PNG', contractorX, signatureY, signatureWidth, 25);
            }
            
            // Linha para assinatura
            doc.line(contractorX, signatureY + 30, contractorX + signatureWidth, signatureY + 30);
            doc.setFontSize(10);
            doc.setFont('times', 'normal');
            doc.text(clientData.nomeCompleto.toUpperCase(), contractorX + signatureWidth / 2, signatureY + 35, { align: 'center' });
            doc.text("CONTRATANTE", contractorX + signatureWidth / 2, signatureY + 40, { align: 'center' });

            // Assinatura do contratado
            doc.setFont('times', 'italic');
            doc.setFontSize(12);
            doc.text('ROI-360', contractedX + signatureWidth/2, signatureY + 25, {align: 'center'});
            
            // Linha para assinatura
            doc.line(contractedX, signatureY + 30, contractedX + signatureWidth, signatureY + 30);
            doc.setFont('times', 'normal');
            doc.setFontSize(10);
            doc.text('MATHEUS HENRIQUE LAURINDO', contractedX + signatureWidth / 2, signatureY + 35, { align: 'center' });
            doc.text("CONTRATADO", contractedX + signatureWidth / 2, signatureY + 40, { align: 'center' });

            // Salvar o PDF
            const fileName = `Contrato_${clientData.nomeCompleto.replace(/\s/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
            
            return doc.output('datauristring');
        }

        async function finalizeContract(e) {
            const button = e.currentTarget;

            if (!currentClientData) {
                showNotification("Por favor, preencha e salve os dados do contratante primeiro.", "error");
                document.querySelector('[data-tab="parties"]').click();
                return;
            }

            button.disabled = true;
            document.getElementById('btn-text').classList.add('hidden');
            document.getElementById('btn-spinner').classList.remove('hidden');

            const signatureCanvas = document.getElementById('signature-canvas');
            const emptyCanvas = document.createElement('canvas');
            emptyCanvas.width = signatureCanvas.width; emptyCanvas.height = signatureCanvas.height;
            if (signatureCanvas.toDataURL() === emptyCanvas.toDataURL()) {
                showNotification("A assinatura do contratante é obrigatória.", "error");
                document.querySelector('[data-tab="signatures"]').click();
                button.disabled = false;
                document.getElementById('btn-text').classList.remove('hidden');
                document.getElementById('btn-spinner').classList.add('hidden');
                return;
            }
            const signatureDataURL = signatureCanvas.toDataURL('image/png');

            try {
                showNotification("Gerando PDF do contrato...", "info");
                await generateContractPDF(currentClientData, signatureDataURL);
                
                showNotification("Salvando contrato no sistema...", "info");
                
                if (!userId) {
                    throw new Error("Autenticação do usuário não encontrada. A página será recarregada.");
                }
                
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const docId = currentClientData.cnpj.replace(/\D/g, '') + '_' + Date.now();
                const contractPath = `artifacts/${appId}/users/${userId}/contracts`;
                
                const contractData = {
                    ...currentClientData,
                    planName: selectedPlan.name,
                    planPriceText: selectedPlan.priceText,
                    signedAt: new Date().toISOString(),
                    signature: signatureDataURL
                };
                
                await setDoc(doc(db, contractPath, docId), contractData);
                
                showNotification("Contrato salvo! Redirecionando para pagamento...", "success");
                
                setTimeout(() => {
                    showCheckout();
                }, 1500);

            } catch (error) {
                console.error("Erro ao finalizar contrato:", error);
                showNotification(`Erro: ${error.message}`, "error", 6000);
                if (error.message.includes("Autenticação")) {
                    setTimeout(() => window.location.reload(), 6000);
                }
            } finally {
                button.disabled = false;
                document.getElementById('btn-text').classList.remove('hidden');
                document.getElementById('btn-spinner').classList.add('hidden');
            }
        }

        function showCheckout() {
            mainContent.classList.add('hidden');
            contractSection.classList.add('hidden');
            
            const summarySpan = document.getElementById('checkout-summary').querySelector('span');
            if (summarySpan) {
                summarySpan.textContent = selectedPlan.name;
            }

            const pixContainer = document.getElementById('pix-container');
            const pixKeys = {
                organico_ia: "00020126580014br.gov.bcb.pix0136c77aad1d-c47a-4c55-a3fb-09c4788fadd152040000530398654077513.165802BR5925MATHEUS HENRIQUE LAURINDO6008BLUMENAU62290525X7M6U8RQ48GMCLTUGLW55R2KT630496D5",
                dominio_360: "00020126580014br.gov.bcb.pix0136c77aad1d-c47a-4c55-a3fb-09c4788fadd1520400005303986540812521.935802BR5925MATHEUS HENRIQUE LAURINDO6008BLUMENAU62290525PSJM9CL96QDYWTX573RS5EXS7630457C6"
            };

            const planKey = Object.keys(planDetails).find(key => planDetails[key].name === selectedPlan.name);
            const pixKey = pixKeys[planKey];

            if (pixKey && pixContainer) {
                pixContainer.innerHTML = `
                    <div class="text-center">
                        <h3 class="text-2xl font-bold mb-2 text-indigo-400">Pagamento via PIX</h3>
                        <p class="text-lg font-semibold mb-1">Valor: ${selectedPlan.priceText}</p>
                        <p class="text-gray-400 mb-6">Escaneie o QR Code ou copie a chave PIX</p>
                        
                        <!-- QR Code -->
                        <div class="flex justify-center mb-6">
                            <div class="bg-white p-4 rounded-lg shadow-lg">
                                <img src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(pixKey)}" 
                                     alt="QR Code PIX" 
                                     width="250" 
                                     height="250" 
                                     class="rounded" />
                            </div>
                        </div>
                        
                        <!-- Chave PIX -->
                        <div class="max-w-md mx-auto">
                            <label class="block text-sm font-medium text-gray-300 mb-2">
                                Chave PIX (Copia e Cola):
                            </label>
                            <div class="flex items-center bg-gray-800 rounded-lg border border-gray-600">
                                <input type="text" 
                                       id="pix-key-input" 
                                       class="flex-1 bg-transparent text-gray-300 text-sm p-3 rounded-l-lg border-none outline-none" 
                                       value="${pixKey}" 
                                       readonly>
                                <button id="copy-pix-key-btn" 
                                        class="bg-indigo-600 hover:bg-indigo-700 text-white p-3 rounded-r-lg transition-colors duration-200 flex items-center justify-center min-w-[48px]" 
                                        title="Copiar chave PIX">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Instruções -->
                        <div class="mt-8 p-4 bg-gray-900 rounded-lg border border-gray-700">
                            <h4 class="font-semibold text-indigo-400 mb-2">Instruções de Pagamento:</h4>
                            <ol class="text-sm text-gray-300 text-left space-y-1">
                                <li>1. Abra o app do seu banco</li>
                                <li>2. Escolha a opção PIX</li>
                                <li>3. Escaneie o QR Code ou cole a chave</li>
                                <li>4. Confirme o pagamento</li>
                                <li>5. Envie o comprovante para nosso WhatsApp</li>
                            </ol>
                        </div>
                        
                        <!-- Contato -->
                        <div class="mt-6">
                            <p class="text-sm text-gray-400 mb-3">
                                Após o pagamento, envie o comprovante:
                            </p>
                            <a href="https://wa.me/5547999999999" 
                               target="_blank" 
                               class="inline-flex items-center bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.088"/>
                                </svg>
                                Enviar Comprovante
                            </a>
                        </div>
                    </div>
                `;

                // Funcionalidade de copiar
                const copyButton = document.getElementById('copy-pix-key-btn');
                const pixInput = document.getElementById('pix-key-input');
                
                if (copyButton && pixInput) {
                    copyButton.addEventListener('click', async () => {
                        try {
                            // Tentar usar a API moderna de clipboard
                            if (navigator.clipboard && window.isSecureContext) {
                                await navigator.clipboard.writeText(pixKey);
                                showNotification("Chave PIX copiada com sucesso! ✓", "success");
                            } else {
                                // Fallback para navegadores mais antigos
                                pixInput.select();
                                pixInput.setSelectionRange(0, 99999);
                                document.execCommand('copy');
                                showNotification("Chave PIX copiada! ✓", "success");
                                window.getSelection().removeAllRanges();
                            }
                            
                            // Feedback visual
                            copyButton.classList.add('bg-green-600');
                            copyButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>';
                            
                            setTimeout(() => {
                                copyButton.classList.remove('bg-green-600');
                                copyButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>';
                            }, 2000);
                            
                        } catch (err) {
                            console.error('Erro ao copiar:', err);
                            showNotification("Erro ao copiar. Selecione e copie manualmente.", "error");
                        }
                    });
                }
            }

            checkoutSection.classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        document.addEventListener('DOMContentLoaded', async () => {
            // Disable plan buttons on page load, show a loading state, and save their original text
            document.querySelectorAll('button[data-plan]').forEach(button => {
                button.dataset.originalText = button.innerHTML;
                button.disabled = true;
                button.innerHTML = `<span class="inline-flex items-center justify-center">
                                      <svg class="animate-spin h-5 w-5 mr-3 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                      </svg>
                                      Conectando...
                                    </span>`;
            });

            // Initialize Firebase. The onAuthStateChanged listener inside will enable the buttons.
            await initializeFirebase();
            
            // Set up listeners for the plan buttons
            document.querySelectorAll('[data-plan]').forEach(button => {
                button.addEventListener('click', () => {
                    // Double-check if auth is ready before proceeding
                    if (isAuthReady) {
                        setupContract(button.getAttribute('data-plan'));
                    } else {
                        showNotification("Aguarde a conexão com o sistema de autenticação.", "info");
                    }
                });
            });

            // Set up listener for the back button
            document.getElementById('back-to-proposal-btn').addEventListener('click', () => {
                checkoutSection.classList.add('hidden');
                mainContent.classList.remove('hidden');
                window.scrollTo({ top: document.getElementById('pricing').offsetTop, behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>
